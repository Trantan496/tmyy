<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- ƒê√£ c·∫≠p nh·∫≠t ti√™u ƒë·ªÅ -->
    <title>üíñ Ch√∫c My Thi T·ªët (Phi√™n b·∫£n MP3) üíñ</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-bg: #000000;
            --glow-color: #ffb3c6;
            --lid-fill: #ffb3c6;
            
            --text-light: #ffffff;
            --text-glow: var(--glow-color);
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: var(--dark-bg);
            height: 100vh;
            font-family: 'Quicksand', sans-serif;
            color: #fff;
            transition: background 2s ease-in-out;
            cursor: default;
        }

        body.reveal {
            cursor: crosshair;
        }

        /* N·ªÅn sao - C·∫¨P NH·∫¨T ƒë·ªÉ nh√¨n th·∫≠t h∆°n */
        @keyframes animStar {
            from { transform: translateY(0px); }
            to { transform: translateY(-2000px); }
        }
        #stars, #stars2, #stars3 {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: transparent;
            animation: animStar linear infinite;
            opacity: 1; /* Lu√¥n visible */
            transition: opacity 2s ease-in-out;
        }
        #stars {
            width: 1px; height: 1px;
            box-shadow: 624px 1308px #FFF, 1739px 728px #FFF, 360px 584px #FFF, 1599px 740px #FFF, 1075px 1146px #FFF, 1690px 1014px #FFF, 1332px 1729px #FFF, 891px 1195px #FFF, 1084px 34px #FFF, 1149px 1310px #FFF, 793px 800px #FFF, 518px 1735px #FFF, 1024px 1731px #FFF, 1302px 1475px #FFF, 185px 1290px #FFF, 1836px 972px #FFF, 1473px 1868px #FFF, 1630px 423px #FFF, 737px 550px #FFF, 1337px 1196px #FFF, 735px 1208px #FFF, 240px 1205px #FFF, 1740px 184px #FFF, 1087px 512px #FFF, 155px 148px #FFF, 1762px 144px #FFF, 1899px 1184px #FFF, 1269px 718px #FFF, 1872px 1409px #FFF, 1149px 184px #FFF, 1803px 561px #FFF, 1374px 1178px #FFF, 1152px 1279px #FFF, 1421px 1806px #FFF, 26px 1474px #FFF, 1851px 71px #FFF, 1509px 1120px #FFF, 1431px 632px #FFF, 946px 1483px #FFF, 1106px 1604px #FFF, 1509px 1372px #FFF, 104px 1978px #FFF, 1749px 1238px #FFF, 1968px 1235px #FFF, 1980px 1632px #FFF, 1109px 1088px #FFF, 1342px 792px #FFF, 128px 1215px #FFF, 1000px 790px #FFF, 1967px 1585px #FFF, 1085px 1799px #FFF, 340px 1386px #FFF, 621px 1904px #FFF, 888px 1908px #FFF, 937px 1319px #FFF, 731px 1801px #FFF, 1018px 1916px #FFF, 1840px 1221px #FFF, 1000px 338px #FFF, 1944px 1209px #FFF, 1330px 1012px #FFF, 1127px 1266px #FFF, 428px 1232px #FFF, 502px 1122px #FFF, 1095px 1303px #FFF, 814px 1251px #FFF, 1629px 1635px #FFF, 1406px 1987px #FFF, 1100px 1603px #FFF, 999px 1349px #FFF, 477px 1970px #FFF, 1203px 1383px #FFF, 1808px 233px #FFF, 1952px 658px #FFF, 1581px 1582px #FFF, 1968px 1713px #FFF, 1126px 1568px #FFF, 953px 406px #FFF, 1171px 1445px #FFF, 1461px 828px #FFF, 1910px 1934px #FFF, 1050px 1668px #FFF, 1266px 140px #FFF, 1695px 1656px #FFF, 538px 1438px #FFF, 850px 1148px #FFF, 1315px 1620px #FFF, 1211px 1500px #FFF, 1018px 1226px #FFF, 253px 1512px #FFF, 1125px 944px #FFF, 1213px 1819px #FFF, 1802px 1845px #FFF, 915px 1735px #FFF, 811px 1721px #FFF;
            animation-duration: 200s;
            z-index: -3;
        }
        #stars2 {
            width: 2px; height: 2px;
            box-shadow: 236px 635px #FFF, 1800px 608px #FFF, 1091px 123px #FFF, 705px 574px #FFF, 1138px 1285px #FFF, 1039px 707px #FFF, 20px 888px #FFF, 854px 1121px #FFF, 1503px 747px #FFF, 1419px 1269px #FFF, 513px 1403px #FFF, 1478px 1391px #FFF, 626px 1756px #FFF, 76px 1816px #FFF, 1445px 334px #FFF, 133px 170px #FFF, 730px 129px #FFF, 1267px 43px #FFF, 1680px 1430px #FFF, 506px 1548px #FFF, 715px 1729px #FFF, 1299px 1177px #FFF, 112px 1475px #FFF, 1827px 1103px #FFF, 910px 653px #FFF, 105px 1017px #FFF, 111px 1572px #FFF, 903px 1493px #FFF, 712px 500px #FFF, 1515px 1974px #FFF, 218px 1210px #FFF, 1517px 929px #FFF, 24px 791px #FFF, 157px 1935px #FFF, 582px 479px #FFF, 1888px 1794px #FFF, 730px 115px #FFF, 1201px 1213px #FFF, 1836px 1295px #FFF;
            animation-duration: 100s;
            opacity: 0.8; /* TƒÉng ƒë·ªô s√°ng */
            z-index: -2;
        }
        #stars3 {
            width: 3px; height: 3px;
            box-shadow: 746px 935px #FFF, 1300px 1608px #FFF, 191px 323px #FFF, 805px 674px #FFF, 1238px 1185px #FFF, 1139px 807px #FFF, 320px 1888px #FFF, 954px 1321px #FFF, 1603px 847px #FFF, 1519px 1369px #FFF, 613px 1503px #FFF, 1578px 1491px #FFF, 726px 1856px #FFF, 176px 1916px #FFF, 1545px 434px #FFF, 233px 270px #FFF, 830px 229px #FFF, 1367px 143px #FFF, 1780px 1530px #FFF, 606px 1648px #FFF;
            animation-duration: 50s; /* Nhanh h∆°n ƒë·ªÉ t·∫°o c·∫£m gi√°c g·∫ßn h∆°n */
            opacity: 0.6; /* TƒÉng ƒë·ªô s√°ng */
            z-index: -1;
        }

        /* Subtitle */
        .subtitle {
            position: fixed;
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: #fff;
            text-shadow: 0 0 10px var(--glow-color);
            opacity: 0;
            transition: opacity 1.5s ease;
            z-index: 1;
        }
        body.intro .subtitle {
            opacity: 1;
        }

        /* --- START: CSS H·ªôp Qu√† --- */
        .gift-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 0;
            z-index: 10;
            cursor: pointer;

            width: 180px;
            height: 180px;
            background: #f8b8d4;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(255, 182, 193, 0.5);
            
            transition: opacity 1.5s ease, transform 1.5s ease, filter 0.3s ease, all 0.3s ease;
        }
        .gift-box.visible {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            animation: float 2s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) scale(1) translateY(0px); }
            50% { transform: translate(-50%, -50%) scale(1) translateY(-10px); }
        }
        .gift-box:focus {
            outline: 2px solid var(--glow-color);
            outline-offset: 5px;
        }
        .gift-box::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 30%;
            background: #f7a5c8;
            border-radius: 12px 12px 4px 4px;
        }
        .ribbon-horizontal, .ribbon-vertical {
            position: absolute;
            background: #fff;
        }
        .ribbon-horizontal {
            top: 45%;
            left: 0;
            width: 100%;
            height: 14px;
        }
        .ribbon-vertical {
            top: 0;
            left: 47%;
            width: 14px;
            height: 100%;
        }
        .bow {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 30px;
        }
        .bow::before, .bow::after {
            content: "";
            position: absolute;
            top: 0;
            width: 30px;
            height: 30px;
            background: #fff;
            border-radius: 50% 50% 0 0;
            transform-origin: bottom center;
            transition: all 0.3s ease;
        }
        .bow::before {
            left: 0;
            transform: rotate(-30deg);
        }
        .bow::after {
            right: 0;
            transform: rotate(30deg);
        }
        .gift-box:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 0 30px rgba(255, 182, 193, 0.7);
        }
        .gift-box:hover .bow::before {
            transform: rotate(-45deg);
        }
        .gift-box:hover .bow::after {
            transform: rotate(45deg);
        }
        .glow {
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,192,203,0.4), transparent);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            z-index: -1;
            animation: pulse 2s infinite ease-in-out;
        }
        @keyframes pulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0.5;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 0.8;
            }
        }
        /* --- END: CSS H·ªôp Qu√† --- */


        /* Thi·ªáp "Th·ªßy Tinh M·ªù" */
        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.2) translateY(0px);
            width: 80vw;
            max-width: 500px;
            padding: 30px;
            
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            
            color: var(--text-light);
            opacity: 0;
            transition: opacity 0.8s ease 0.2s,
                        transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.2s;
            z-index: 20;
            text-align: center;
        }
        .message.visible {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1) translateY(0);
        }
        
        /* Khung ·∫£nh c·ªßa My */
        .my-image-container {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--lid-fill);
            box-shadow: 0 0 10px var(--lid-fill);
            border-radius: 50%;
            margin: 0 auto 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 12px;
            color: var(--text-light);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .my-image-container:hover {
             transform: scale(1.05);
             box-shadow: 0 0 15px #fff;
        }
        .my-image-container:empty::before {
            content: "Th√™m ·∫£nh My t·∫°i ƒë√¢y";
            opacity: 0.7;
            padding: 10px;
        }
        .my-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .message h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            font-weight: 700;
            color: var(--text-light);
            margin-top: 0;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        .message h1 span {
            color: var(--text-glow);
            text-shadow: 0 0 5px var(--text-glow);
        }
        .message p {
            font-family: 'Quicksand', sans-serif;
            font-size: clamp(1rem, 2.5vw, 1.25rem);
            font-weight: 500;
            line-height: 1.6;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .message .char, .message .word {
            opacity: 0;
            transform: translateY(10px);
            filter: blur(5px);
            transition: opacity 0.3s ease, transform 0.3s ease, filter 0.3s ease;
        }
        .message .char.visible, .message .word.visible {
            opacity: 1;
            transform: translateY(0);
            filter: blur(0);
        }
        #final-cheer {
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            font-weight: 700;
            text-align: center;
            color: var(--text-light);
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.5s ease, transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-shadow: 0 0 10px var(--text-glow);
        }
        #final-cheer.visible {
            opacity: 1;
            transform: scale(1);
        }

        .hidden {
            display: none;
        }

        /* Canvas hi·ªáu ·ª©ng t·ªïng th·ªÉ */
        canvas#effectsCanvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 5;
        }

        /* Canvas tr√°i tim */
        canvas#pinkboard {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0; /* ·∫®n ban ƒë·∫ßu */
            transition: opacity 2s ease-in-out; /* Fade in */
            z-index: 0; /* ƒê·∫±ng sau thi·ªáp v√† hi·ªáu ·ª©ng, nh∆∞ng tr√™n sao */
        }
        canvas#pinkboard.visible {
            opacity: 1;
        }
        
        /* ƒê√É X√ìA Tr√¨nh ph√°t YouTube */

        .wish-h1{
            color: white;
        }
    </style>
</head>
<body>

    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>
    
    <!-- ƒê√É X√ìA Tr√¨nh ph√°t YouTube -->

    <p class="subtitle" id="subtitle">M·ªôt l·ªùi ch√∫c cho k·ª≥ thi IELTS...</p>

    <div class="container">
        
        <div class="gift-box" id="giftBox" role="button" tabindex="0">
            <div class="ribbon-horizontal"></div>
            <div class="ribbon-vertical"></div>
            <div class="bow"></div>
            <div class="glow"></div>
        </div>

        <div class="message hidden" id="message">
            
            <div class="my-image-container">
                 <img src="Hello.jpg" alt="·∫¢nh c·ªßa My"></div>

            <h1 id="wish-h1"><span>üíñ</span> Ch√∫c Conheo thi t·ªët <span>üíñ</span></h1>
            <p id="wish-p">C·ªê L√äN C·ªê LENNN, B√åNH Tƒ®NH T·ª∞ TIN</p>
            <p id="final-cheer" class="hidden">You can do it! üåü 8.0 LISTENING</p>
        </div>

    </div>
    
    <canvas id="effectsCanvas"></canvas>
    <canvas id="pinkboard"></canvas>
    
    <!-- TH√äM D√íNG N√ÄY: Thay 'nhac-nen.mp3' b·∫±ng t√™n file nh·∫°c c·ªßa b·∫°n -->
    <audio id="bg-music" src="nhac-nen.mp3" loop></audio>

    <script>
    // T·∫£i th∆∞ vi·ªán Confetti
    (function confettiLib() {
        const confettiScript = document.createElement("script");
        confettiScript.src = "https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js";
        confettiScript.async = true;
        document.head.appendChild(confettiScript);
    })();

    // ƒê√É X√ìA To√†n b·ªô code YouTube API

    // DOM Elements
    const giftBox = document.getElementById("giftBox");
    const message = document.getElementById("message");
    const canvas = document.getElementById("effectsCanvas");
    const ctx = canvas.getContext("2d");
    const subtitle = document.getElementById("subtitle");

    canvas.width = innerWidth;
    canvas.height = innerHeight;
    window.addEventListener('resize', () => {
        canvas.width = innerWidth;
        canvas.height = innerHeight;

        const pinkboard = document.getElementById('pinkboard');
        if (pinkboard) {
            pinkboard.width  = pinkboard.clientWidth;
            pinkboard.height = pinkboard.clientHeight;
        }
    });

    // State
    let orbs = [];
    let sparkles = [];
    let effectsStarted = false;
    let animationLoopId = null;

    // --- Hi·ªáu ·ª®ng Canvas --- 
    function createOrb() {
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 4 + 1;
        const color = Math.random() > 0.3 ? "rgba(255, 182, 193, 0.9)" : "rgba(255, 255, 255, 0.9)";
        
        orbs.push({
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: Math.random() * 4 + 2,
            speedX: Math.cos(angle) * speed,
            speedY: Math.sin(angle) * speed,
            alpha: 1.0,
            friction: 0.97 + Math.random() * 0.02,
            color: color
        });
    }

    function createSparkle(x, y) {
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 2 + 0.5;
        sparkles.push({
            x: x,
            y: y,
            radius: Math.random() * 2 + 1,
            speedX: Math.cos(angle) * speed,
            speedY: Math.sin(angle) * speed,
            alpha: 1.0,
            friction: 0.95,
            color: "rgba(255, 255, 255, 0.8)"
        });
    }

    function centerConfetti() {
        if (typeof confetti !== 'function') {
            setTimeout(centerConfetti, 100);
            return;
        }
        const colors = ['#ffd6e8', '#ffb6c1', '#f9a1c2', '#ffffff'];
        confetti({
            particleCount: 150,
            angle: 90,
            spread: 180,
            origin: { x: 0.5, y: 0.5 },
            colors: colors,
            gravity: 0.7,
            decay: 0.92
        });
    }

    function drawAndAnimate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let hasActiveParticles = false;

        for (let i = orbs.length - 1; i >= 0; i--) {
            const orb = orbs[i];
            orb.x += orb.speedX;
            orb.y += orb.speedY;
            orb.speedY += 0.02;
            orb.speedX *= orb.friction;
            orb.speedY *= orb.friction;
            orb.alpha -= 0.01;
            
            if (orb.alpha <= 0) {
                orbs.splice(i, 1);
                continue;
            }
            hasActiveParticles = true;
            
            ctx.beginPath();
            const gradient = ctx.createRadialGradient(orb.x, orb.y, 0, orb.x, orb.y, orb.radius);
            const baseColor = orb.color.includes('182') ? '255, 182, 193' : '255, 255, 255';
            gradient.addColorStop(0, `rgba(255, 255, 255, ${orb.alpha})`);
            gradient.addColorStop(0.4, `rgba(${baseColor}, ${orb.alpha * 0.9})`);
            gradient.addColorStop(1, `rgba(${baseColor}, 0)`);
            ctx.fillStyle = gradient;
            ctx.arc(orb.x, orb.y, orb.radius, 0, Math.PI * 2);
            ctx.fill();
        }

        for (let i = sparkles.length - 1; i >= 0; i--) {
            const s = sparkles[i];
            s.x += s.speedX;
            s.y += s.speedY;
            s.speedX *= s.friction;
            s.speedY *= s.friction;
            s.alpha -= 0.04;
            
            if (s.alpha <= 0) {
                sparkles.splice(i, 1);
                continue;
            }
            hasActiveParticles = true;
            
            ctx.fillStyle = `rgba(255, 255, 255, ${s.alpha})`;
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
            ctx.fill();
        }
        
        if (hasActiveParticles) {
            animationLoopId = requestAnimationFrame(drawAndAnimate);
        } else {
            animationLoopId = null;
        }
    }

    function startAnimationLoop() {
        if (!animationLoopId) {
            animationLoopId = requestAnimationFrame(drawAndAnimate);
        }
    }


    // --- Logic K·ªÉ Chuy·ªán --- 
    function animateText() {
        const h1 = document.getElementById("wish-h1");
        const p = document.getElementById("wish-p");
        
        const h1Text = " Ch√∫c Ch√† mii thi t·ªëtt! ";
        const h1Chars = h1Text.split("").map(char => `<span class="char">${char}</span>`).join("");
        h1.innerHTML = `<span>üíñ</span>${h1Chars}<span>üíñ</span>`;
        
        const pText = p.innerHTML.replace(/<br>/g, ' <br> ');
        const pWords = pText.split(' ').map(word => {
            if (word === '<br>') return '<br>';
            return `<span class="word">${word}</span>`;
        }).join(' ');
        p.innerHTML = pWords;

        const elements = document.querySelectorAll('.message .char, .message .word');
        let totalDelay = 0;
        elements.forEach((el, index) => {
            totalDelay = (index * 30);
            setTimeout(() => {
                el.classList.add('visible');
            }, totalDelay);
        });
        
        const finalCheer = document.getElementById("final-cheer");
        setTimeout(() => {
            finalCheer.classList.remove("hidden");
            finalCheer.classList.add("visible");
        }, totalDelay + 400);
    }

    function showWish() {
        message.classList.remove('hidden');
        message.classList.add('visible');
        setTimeout(animateText, 800);
    }

    function openGift() {
        if (effectsStarted) return;
        effectsStarted = true;
        
        giftBox.style.animation = "none";
        giftBox.style.transition = "opacity 1s ease-out, transform 1s cubic-bezier(0.68, -0.55, 0.27, 1.55)";
        giftBox.style.opacity = 0;
        giftBox.style.transform = "translate(-50%, -100%) scale(0.5)"; 
        
        // === ƒê√ÇY L√Ä PH·∫¶N ƒê√É THAY ƒê·ªîI ===
        // B·∫≠t nh·∫°c MP3 khi click
        const music = document.getElementById('bg-music');
        if (music) {
            music.volume = 0; // B·∫Øt ƒë·∫ßu v·ªõi √¢m l∆∞·ª£ng = 0
            music.play();     // B·∫Øt ƒë·∫ßu ph√°t (tr√¨nh duy·ªát s·∫Ω cho ph√©p v√¨ ƒë√¢y l√† click)

            // TƒÉng d·∫ßn √¢m l∆∞·ª£ng (volume c·ªßa audio l√† t·ª´ 0.0 ƒë·∫øn 1.0)
            let currentVolume = 0;
            let fadeInterval = setInterval(() => {
                currentVolume += 0.05; // TƒÉng 5% 
                if (currentVolume >= 1.0) {
                    currentVolume = 1.0;
                    clearInterval(fadeInterval);
                }
                music.volume = currentVolume;
            }, 100); // M·ªói 100ms
        }
        // === K·∫æT TH√öC PH·∫¶N THAY ƒê·ªîI ===

        setTimeout(() => {
            const pinkboard = document.getElementById('pinkboard');
            if (pinkboard) {
                pinkboard.classList.add('visible'); 
                startHeartEffect(pinkboard);
            }

            document.body.classList.add("reveal");
            centerConfetti();
            startAnimationLoop();
            for(let i = 0; i < 100; i++) {
                createOrb();
            }
            setTimeout(showWish, 100);
        }, 400);
    }

    function showGiftBox() {
        subtitle.style.opacity = 0;
        
        setTimeout(() => {
            subtitle.remove();
            giftBox.classList.add("visible");
        }, 2000);
    }

    window.onload = () => {
        document.body.classList.add("intro");
        setTimeout(showGiftBox, 3000);
        
        giftBox.addEventListener("click", openGift);
        giftBox.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
                openGift();
            }
        });

        function handleInteraction(x, y) {
            if (document.body.classList.contains("reveal")) {
                createSparkle(x, y);
                startAnimationLoop();
            }
        }
        
        window.addEventListener('mousemove', (e) => {
            handleInteraction(e.clientX, e.clientY);
        });
        window.addEventListener('touchmove', (e) => {
            if (e.touches.length > 0) {
                handleInteraction(e.touches[0].clientX, e.touches[0].clientY);
            }
        });
    };
    
    // --- V13.2: B·∫ÆT ƒê·∫¶U CODE HI·ªÜU ·ª®NG TR√ÅI TIM (Kh√¥ng thay ƒë·ªïi) ---
    
    var settings = {
      particles: {
        length:   500,
        duration:   2,
        velocity: 100,
        effect: -0.75,
        size:      30,
      },
    };

    (function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());

    var Point = (function() {
      function Point(x, y) {
        this.x = (typeof x !== 'undefined') ? x : 0;
        this.y = (typeof y !== 'undefined') ? y : 0;
      }
      Point.prototype.clone = function() {
        return new Point(this.x, this.y);
      };
      Point.prototype.length = function(length) {
        if (typeof length == 'undefined')
          return Math.sqrt(this.x * this.x + this.y * this.y);
        this.normalize();
        this.x *= length;
        this.y *= length;
        return this;
      };
      Point.prototype.normalize = function() {
        var length = this.length();
        this.x /= length;
        this.y /= length;
        return this;
      };
      return Point;
    })();

    var Particle = (function() {
      function Particle() {
        this.position = new Point();
        this.velocity = new Point();
        this.acceleration = new Point();
        this.age = 0;
      }
      Particle.prototype.initialize = function(x, y, dx, dy) {
        this.position.x = x;
        this.position.y = y;
        this.velocity.x = dx;
        this.velocity.y = dy;
        this.acceleration.x = dx * settings.particles.effect;
        this.acceleration.y = dy * settings.particles.effect;
        this.age = 0;
      };
      Particle.prototype.update = function(deltaTime) {
        this.position.x += this.velocity.x * deltaTime;
        this.position.y += this.velocity.y * deltaTime;
        this.velocity.x += this.acceleration.x * deltaTime;
        this.velocity.y += this.acceleration.y * deltaTime;
        this.age += deltaTime;
      };
      Particle.prototype.draw = function(context, image) {
        function ease(t) {
          return (--t) * t * t + 1;
        }
        var size = image.width * ease(this.age / settings.particles.duration);
        context.globalAlpha = 1 - this.age / settings.particles.duration;
        context.drawImage(image, this.position.x - size / 2, this.position.y - size / 2, size, size);
      };
      return Particle;
    })();

    var ParticlePool = (function() {
      var particles,
          firstActive = 0,
          firstFree   = 0,
          duration     = settings.particles.duration;
     
      function ParticlePool(length) {
        particles = new Array(length);
        for (var i = 0; i < particles.length; i++)
          particles[i] = new Particle();
      }
      ParticlePool.prototype.add = function(x, y, dx, dy) {
        particles[firstFree].initialize(x, y, dx, dy);
       
        firstFree++;
        if (firstFree   == particles.length) firstFree   = 0;
        if (firstActive == firstFree       ) firstActive++;
        if (firstActive == particles.length) firstActive = 0;
      };
      ParticlePool.prototype.update = function(deltaTime) {
        var i;
       
        if (firstActive < firstFree) {
          for (i = firstActive; i < firstFree; i++)
            particles[i].update(deltaTime);
        }
        if (firstFree < firstActive) {
          for (i = firstActive; i < particles.length; i++)
            particles[i].update(deltaTime);
          for (i = 0; i < firstFree; i++)
            particles[i].update(deltaTime);
        }
       
        while (particles[firstActive].age >= duration && firstActive != firstFree) {
          firstActive++;
          if (firstActive == particles.length) firstActive = 0;
        }
      };
      ParticlePool.prototype.draw = function(context, image) {
        var i;
        if (firstActive < firstFree) {
          for (i = firstActive; i < firstFree; i++)
            particles[i].draw(context, image);
        }
        if (firstFree < firstActive) {
          for (i = firstActive; i < particles.length; i++)
            particles[i].draw(context, image);
          for (i = 0; i < firstFree; i++)
            particles[i].draw(context, image);
        }
      };
      return ParticlePool;
    })();

    function startHeartEffect(canvas) {
      var context = canvas.getContext('2d'),
          particles = new ParticlePool(settings.particles.length),
          particleRate = settings.particles.length / settings.particles.duration,
          time;
     
      function pointOnHeart(t) {
        return new Point(
          160 * Math.pow(Math.sin(t), 3),
          130 * Math.cos(t) - 50 * Math.cos(2 * t) - 20 * Math.cos(3 * t) - 10 * Math.cos(4 * t) + 25
        );
      }
     
      var image = (function() {
        var canvas  = document.createElement('canvas'),
            context = canvas.getContext('2d');
        canvas.width  = settings.particles.size;
        canvas.height = settings.particles.size;
        function to(t) {
          var point = pointOnHeart(t);
          point.x = settings.particles.size / 2 + point.x * settings.particles.size / 350;
          point.y = settings.particles.size / 2 - point.y * settings.particles.size / 350;
          return point;
        }
        context.beginPath();
        var t = -Math.PI;
        var point = to(t);
        context.moveTo(point.x, point.y);
        while (t < Math.PI) {
          t += 0.01;
          point = to(t);
          context.lineTo(point.x, point.y);
        }
        context.closePath();
        context.fillStyle = '#ea80b0';
        context.fill();
        var image = new Image();
        image.src = canvas.toDataURL();
        return image;
      })();
     
      function render() {
        requestAnimationFrame(render);
       
        var newTime   = new Date().getTime() / 1000,
            deltaTime = newTime - (time || newTime);
        time = newTime;
       
        context.clearRect(0, 0, canvas.width, canvas.height);
       
        var amount = particleRate * deltaTime;
        for (var i = 0; i < amount; i++) {
          var pos = pointOnHeart(Math.PI - 2 * Math.PI * Math.random());
          var dir = pos.clone().length(settings.particles.velocity);
          particles.add(canvas.width / 2 + pos.x, canvas.height / 2 - pos.y, dir.x, -dir.y);
        }
       
        particles.update(deltaTime);
        particles.draw(context, image);
      }
     
      function onResize() {
        canvas.width  = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
      }
     
      setTimeout(function() {
        onResize();
        render();
      }, 10);
    }
    // --- K·∫æT TH√öC CODE HI·ªÜU ·ª®NG TR√ÅI TIM ---
    </script>
</body>
</html>
